<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QHSLab — Python Editor</title>
<link rel="icon" href="https://www.python.org/static/favicon.ico" type="image/x-icon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/mode-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-one_dark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-chrome.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ext-language_tools.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--fm:'Consolas',monospace;--fb:'DM Sans',sans-serif;--r:10px;--rs:6px;--tr:.25s cubic-bezier(.4,0,.2,1)}
[data-theme="dark"]{--b0:#0f1117;--b1:#1a1d27;--b2:#242836;--b3:#2d3245;--bd:#2e3348;--t1:#e2e4ed;--t2:#8b90a5;--t3:#5c6178;--ac:#6c7ee1;--gn:#4ade80;--gb:rgba(74,222,128,.15);--gd:rgba(74,222,128,.3);--rd:#f87171;--rb:rgba(248,113,113,.15);--rbd:rgba(248,113,113,.3);--or:#fb923c;--bl:#60a5fa;--bb:rgba(96,165,250,.15);--bbd:rgba(96,165,250,.3);--pu:#a78bfa;--pb:rgba(167,139,250,.12);--pbd:rgba(167,139,250,.25);--cb:#0c0e14;--sh:0 4px 24px rgba(0,0,0,.4)}
[data-theme="light"]{--b0:#f5f6fa;--b1:#fff;--b2:#ebedf5;--b3:#e0e3ef;--bd:#d4d7e5;--t1:#1a1d2e;--t2:#5c6178;--t3:#8b90a5;--ac:#5568d4;--gn:#16a34a;--gb:rgba(22,163,74,.12);--gd:rgba(22,163,74,.25);--rd:#dc2626;--rb:rgba(220,38,38,.1);--rbd:rgba(220,38,38,.2);--or:#ea580c;--bl:#2563eb;--bb:rgba(37,99,235,.1);--bbd:rgba(37,99,235,.2);--pu:#7c3aed;--pb:rgba(124,58,237,.08);--pbd:rgba(124,58,237,.2);--cb:#f0f1f5;--sh:0 4px 24px rgba(0,0,0,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--fb);background:var(--b0);color:var(--t1);height:100vh;overflow:hidden;transition:background var(--tr),color var(--tr)}
.topbar{height:56px;background:var(--b1);border-bottom:1px solid var(--bd);display:flex;align-items:center;padding:0 12px;gap:8px;z-index:100;transition:background var(--tr)}
.logo{font-family:var(--fm);font-weight:700;font-size:19px;color:var(--ac);display:flex;align-items:center;gap:8px;user-select:none}.logo svg{width:22px;height:22px}
.tdiv{width:1px;height:26px;background:var(--bd);margin:0 4px;flex-shrink:0}
.tg{display:flex;align-items:center;gap:6px}
.tright{margin-left:auto;display:flex;align-items:center;gap:6px}
.btn{font-family:var(--fb);font-size:13.5px;font-weight:600;border:none;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:7px;padding:9px 16px;transition:all var(--tr);white-space:nowrap;color:var(--t2);background:transparent}.btn:hover{background:var(--b3);color:var(--t1)}.btn svg{width:17px;height:17px;flex-shrink:0}
.btn-run{background:var(--gb);border:1.5px solid var(--gd);color:var(--gn);padding:9px 20px}.btn-run:hover{background:var(--gn);color:#fff;border-color:var(--gn)}
.btn-stop{background:var(--rb);border:1.5px solid var(--rbd);color:var(--rd);padding:9px 20px}.btn-stop:hover{background:var(--rd);color:#fff;border-color:var(--rd)}
.btn-file{background:var(--bb);border:1.5px solid var(--bbd);color:var(--bl)}.btn-file:hover{background:var(--bl);color:#fff;border-color:var(--bl)}
.btn-icon{padding:9px 10px;border:1.5px solid var(--bd);background:var(--b2);color:var(--t2)}.btn-icon:hover{border-color:var(--ac);color:var(--ac);background:var(--b3)}
.btn-sm{padding:5px 8px;font-size:12px;border-radius:6px;font-weight:600;border:1px solid var(--bd);background:var(--b2);color:var(--t2);cursor:pointer;display:inline-flex;align-items:center;gap:5px;transition:all var(--tr);font-family:var(--fb)}.btn-sm svg{width:14px;height:14px}.btn-sm:hover{color:var(--t1);background:var(--b3)}
.fsz{display:flex;align-items:center;gap:3px}.fsz button{width:34px;height:34px;border-radius:8px;border:1.5px solid var(--bd);background:var(--b2);color:var(--t1);font-size:20px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--tr);font-family:var(--fm);line-height:1}.fsz button:hover{border-color:var(--ac);color:var(--ac)}
.theme-btn .icon-sun,.theme-btn .icon-moon{display:none}[data-theme="dark"] .theme-btn .icon-sun{display:block}[data-theme="light"] .theme-btn .icon-moon{display:block}
.dw{position:relative}.dd{position:absolute;top:calc(100% + 6px);right:0;background:var(--b1);border:1px solid var(--bd);border-radius:var(--r);padding:8px;min-width:220px;box-shadow:var(--sh);z-index:200;display:none}.dd.open{display:block}
.dl{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--t3);padding:8px 8px 4px}
.dr{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-radius:var(--rs)}.dr label{font-size:13px;color:var(--t2)}
.tog{position:relative;width:40px;height:22px;background:var(--b2);border:1px solid var(--bd);border-radius:12px;cursor:pointer;transition:all var(--tr);flex-shrink:0}.tog.active{background:var(--ac);border-color:var(--ac)}.tog::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:50%;background:var(--t1);transition:all var(--tr)}.tog.active::after{left:20px;background:#fff}

/* Snippets sidebar */
.sn-overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);z-index:300;opacity:0;pointer-events:none;transition:opacity var(--tr)}.sn-overlay.open{opacity:1;pointer-events:auto}
.sn-panel{position:fixed;top:0;left:0;bottom:0;width:260px;background:var(--b1);border-right:1px solid var(--bd);z-index:301;transform:translateX(-100%);transition:transform var(--tr);display:flex;flex-direction:column;box-shadow:var(--sh)}.sn-panel.open{transform:translateX(0)}
.sn-head{padding:14px 16px;border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between}.sn-head h3{font-family:var(--fm);font-size:14px;font-weight:700;color:var(--ac)}
.sn-close{background:none;border:none;color:var(--t2);cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center}.sn-close:hover{color:var(--t1);background:var(--b3)}.sn-close svg{width:18px;height:18px}
.sn-body{flex:1;overflow-y:auto;padding:4px 6px}.sn-body::-webkit-scrollbar{width:5px}.sn-body::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
.sn-cat{padding:8px 10px 4px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-top:4px}
.sn-item{padding:6px 10px;border-radius:var(--rs);cursor:pointer;transition:background var(--tr);font-family:var(--fm);font-size:13px;color:var(--t1)}.sn-item:hover{background:var(--b3);color:var(--ac)}

/* Main layout */
.main{display:flex;height:calc(100vh - 56px - 28px)}
.editor-pane{flex:1;display:flex;flex-direction:column;min-width:0;border-right:1px solid var(--bd)}
.output-pane{width:45%;min-width:300px;display:flex;flex-direction:column;transition:width .2s,min-width .2s}
.output-pane.minimized{width:42px!important;min-width:42px!important;flex:none!important}
.output-pane.minimized .out-content{display:none}
.output-pane.minimized .out-min-bar{display:flex}
#editor{flex:1;font-family:var(--fm)!important;font-size:15px}.ace_editor{font-family:var(--fm)!important}
.out-content{flex:1;display:flex;flex-direction:column;overflow:hidden}
.out-head{display:flex;align-items:center;background:var(--b1);border-bottom:1px solid var(--bd);padding:0 8px 0 16px;height:38px;gap:8px;transition:background var(--tr)}.out-head span{font-family:var(--fm);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--t3)}.out-head .sp{flex:1}
.out-min-bar{display:none;flex-direction:column;align-items:center;padding-top:12px;gap:8px;background:var(--b1);border-left:1px solid var(--bd);width:42px;height:100%}
.out-min-bar button{width:32px;height:32px;border-radius:var(--rs);border:1px solid var(--bd);background:var(--b2);color:var(--t2);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--tr)}.out-min-bar button:hover{color:var(--ac);border-color:var(--ac)}.out-min-bar button svg{width:16px;height:16px}
.out-min-bar .min-label{writing-mode:vertical-rl;text-orientation:mixed;font-family:var(--fm);font-size:11px;font-weight:600;color:var(--t3);letter-spacing:.5px;margin-top:8px}
.con-area{flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:80px}
#console{flex:1;background:var(--cb);padding:12px 16px;overflow-y:auto;font-family:var(--fm);font-size:13px;line-height:1.7;color:var(--t1);transition:background var(--tr),font-size var(--tr)}#console::-webkit-scrollbar{width:6px}#console::-webkit-scrollbar-track{background:transparent}#console::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
.cl{white-space:pre-wrap;word-break:break-all}.cl.error{color:var(--rd)}.cl.system{color:var(--t3);font-style:italic}.cl.input-echo{color:var(--or)}
.input-bar{display:none;border-top:1px solid var(--bd);background:var(--b1);padding:10px 12px;gap:8px;align-items:center}.input-bar.visible{display:flex}.input-bar label{font-family:var(--fm);font-size:13px;color:var(--or);font-weight:600}.input-bar input{flex:1;font-family:var(--fm);font-size:14px;background:var(--b2);border:1.5px solid var(--bd);border-radius:var(--rs);padding:8px 12px;color:var(--t1);outline:none;transition:border var(--tr)}.input-bar input:focus{border-color:var(--or)}
.hsplit{height:5px;cursor:row-resize;background:transparent;flex-shrink:0;transition:background var(--tr)}.hsplit:hover,.hsplit.dragging{background:var(--ac)}
.files-area{height:180px;min-height:60px;display:flex;flex-direction:column;overflow:hidden;border-top:1px solid var(--bd)}
.files-head{display:flex;align-items:center;background:var(--b1);border-bottom:1px solid var(--bd);padding:0 16px;height:32px}.files-head span{font-family:var(--fm);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--t3)}
#fc{flex:1;overflow-y:auto;background:var(--cb);padding:8px 12px;font-family:var(--fm);font-size:13px;line-height:1.7;color:var(--t1);transition:background var(--tr),font-size var(--tr)}#fc::-webkit-scrollbar{width:6px}#fc::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
.fi{display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:var(--rs);cursor:pointer;transition:background var(--tr);font-size:13px;color:var(--t2)}.fi:hover{background:var(--b3);color:var(--t1)}.fi svg{width:15px;height:15px;color:var(--ac);flex-shrink:0}
.fe{text-align:center;padding:20px;color:var(--t3);font-size:12px}
.statusbar{height:28px;background:var(--b1);border-top:1px solid var(--bd);display:flex;align-items:center;padding:0 12px;font-size:11px;color:var(--t3);gap:16px;font-family:var(--fm)}
.st-dot{width:7px;height:7px;border-radius:50%;background:var(--t3)}.st-dot.ready{background:var(--gn)}.st-dot.loading{background:var(--or);animation:pulse 1s infinite}.st-dot.running{background:var(--ac);animation:pulse .6s infinite}.st-dot.error{background:var(--rd)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.loading-overlay{position:fixed;inset:0;background:var(--b0);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;transition:opacity .4s}.loading-overlay.hidden{opacity:0;pointer-events:none}
.loading-spinner{width:40px;height:40px;border:3px solid var(--bd);border-top-color:var(--ac);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:16px}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:var(--fm);font-size:14px;color:var(--t2)}.loading-sub{font-size:12px;color:var(--t3);margin-top:6px}
.resize-h{width:5px;cursor:col-resize;background:transparent;z-index:10;flex-shrink:0;transition:background var(--tr)}.resize-h:hover,.resize-h.dragging{background:var(--ac)}
@media(max-width:768px){.main{flex-direction:column}.editor-pane{border-right:none;border-bottom:1px solid var(--bd);height:50%}.output-pane{width:100%!important}.resize-h{display:none}.hide-mobile{display:none}}
</style>
</head>
<body>
<div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text">Starting Python Engine…</div><div class="loading-sub">Loading Pyodide (first load may take a moment)</div></div>
<div class="sn-overlay" id="snOverlay"></div>
<div class="sn-panel" id="snPanel"><div class="sn-head"><h3>Code Snippets</h3><button class="sn-close" id="snClose"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><div class="sn-body" id="snBody"></div></div>
<div class="topbar">
<button class="btn btn-icon" id="hamburgerBtn" title="Code snippets"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
<div class="logo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>QHSLab</div>
<div class="tdiv"></div>
<div class="tg">
<button class="btn btn-file" onclick="saveToFile()" title="Save"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span class="hide-mobile">Save</span></button>
<button class="btn btn-file" onclick="document.getElementById('fileInput').click()" title="Open"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span class="hide-mobile">Open</span></button>
<input type="file" id="fileInput" accept=".py,.txt" style="display:none" onchange="openFile(event)">
</div>
<div class="tdiv"></div>
<button class="btn btn-run" id="runBtn" onclick="runCode()"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>Run</button>
<button class="btn btn-stop" id="stopBtn" onclick="stopCode()" style="display:none"><svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>Stop</button>
<div class="tright">
<div class="fsz"><button onclick="changeFontSize(-1)" title="Smaller font">−</button><button onclick="changeFontSize(1)" title="Bigger font">+</button></div>
<div class="tdiv"></div>
<button class="btn btn-icon theme-btn" onclick="toggleTheme()" title="Toggle theme"><svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
<div class="dw" id="settingsWrap"><button class="btn btn-icon" id="settingsBtn" title="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button>
<div class="dd" id="settingsDD"><div class="dl">Editor</div><div class="dr"><label>Line Numbers</label><div class="tog active" id="togLn"></div></div><div class="dr"><label>Word Wrap</label><div class="tog" id="togWr"></div></div><div class="dr"><label>Autocomplete</label><div class="tog" id="togAc"></div></div></div></div>
</div>
</div>
<div class="main">
<div class="editor-pane" id="editorPane"><div id="editor"># Welcome to QHSLab!
# Write your Python code here and press Run (or Ctrl+Enter)

</div></div>
<div class="resize-h" id="resizeH"></div>
<div class="output-pane" id="outputPane">
<div class="out-min-bar"><button onclick="expandConsole()" title="Show console"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button><span class="min-label">CONSOLE</span></div>
<div class="out-content">
<div class="out-head"><span>Console</span><div class="sp"></div><button class="btn-sm" onclick="clearConsole()" title="Clear" style="color:var(--pu);border-color:var(--pbd);background:var(--pb)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>Clear</button><button class="btn-sm btn-icon" onclick="minimizeConsole()" title="Minimize" style="margin-left:2px"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></button></div>
<div class="con-area"><div id="console"></div><div class="input-bar" id="inputBar"><label>▸</label><input type="text" id="inputField" autocomplete="off" spellcheck="false" placeholder="Type your input and press Enter"></div></div>
<div class="hsplit" id="hsplit"></div>
<div class="files-area" id="filesArea"><div class="files-head"><span>Files</span></div><div id="fc"><div class="fe">No files yet. Use <code>open("file.txt","w")</code> to create files.</div></div></div>
</div>
</div>
</div>
<div class="statusbar"><div style="display:flex;align-items:center;gap:6px"><div class="st-dot loading" id="stDot"></div><span id="stTxt">Loading…</span></div><span id="curPos">Ln 1, Col 1</span><span style="margin-left:auto">Ctrl+Enter to Run</span></div>
<script>
var pyodide=null,editor=null,fontSize=15,isRunning=false,inputResolve=null;
// Saved output pane width for restore after minimize
var savedOpWidth=null,savedEpWidth=null;

// ── SNIPPETS DATA ──
var SNIPPETS=[
{cat:"Output & Input",items:[
{l:'print()',c:'print("Hello, World!")'},
{l:'print(f"...")',c:'print(f"Value: {variable}")'},
{l:'input()',c:'answer = input("Enter something: ")'},
{l:'int(input())',c:'number = int(input("Enter a number: "))'},
]},{cat:"Variables & Types",items:[
{l:'variable = value',c:'name = "Alice"\nage = 14\nscore = 9.5'},
{l:'int() / str() / float()',c:'number = int("42")\ntext = str(100)\ndecimal = float("3.14")'},
{l:'type()',c:'print(type(variable))'},
]},{cat:"Conditions",items:[
{l:'if / else',c:'if age >= 18:\n    print("Adult")\nelse:\n    print("Minor")'},
{l:'if / elif / else',c:'if score >= 90:\n    grade = "A"\nelif score >= 80:\n    grade = "B"\nelif score >= 70:\n    grade = "C"\nelse:\n    grade = "D"'},
{l:'and / or / not',c:'if age >= 13 and age <= 19:\n    print("Teenager")'},
]},{cat:"Loops",items:[
{l:'for i in range()',c:'for i in range(5):\n    print(i)'},
{l:'for item in list',c:'for item in my_list:\n    print(item)'},
{l:'while loop',c:'while count < 10:\n    print(count)\n    count += 1'},
{l:'break / continue',c:'for i in range(100):\n    if i == 10:\n        break'},
]},{cat:"Lists",items:[
{l:'Create a list',c:'fruits = ["apple", "banana", "cherry"]'},
{l:'.append()',c:'my_list.append("new item")'},
{l:'.remove()',c:'my_list.remove("item")'},
{l:'len()',c:'print(len(my_list))'},
{l:'sorted()',c:'sorted_list = sorted(my_list)'},
]},{cat:"Strings",items:[
{l:'.upper() / .lower()',c:'print(text.upper())\nprint(text.lower())'},
{l:'.split()',c:'words = sentence.split(" ")'},
{l:'.replace()',c:'new_text = text.replace("old", "new")'},
{l:'"x" in string',c:'if "hello" in text:\n    print("Found!")'},
]},{cat:"Functions",items:[
{l:'def function()',c:'def greet(name):\n    print(f"Hello, {name}!")\n\ngreet("Alice")'},
{l:'def with return',c:'def add(a, b):\n    return a + b\n\nresult = add(3, 5)'},
]},{cat:"Dictionaries",items:[
{l:'Create a dict',c:'person = {\n    "name": "Alice",\n    "age": 14\n}'},
{l:'Loop a dict',c:'for key, value in person.items():\n    print(f"{key}: {value}")'},
]},{cat:"File I/O",items:[
{l:'Write to file',c:'with open("data.txt", "w") as f:\n    f.write("Hello, file!\\n")'},
{l:'Read a file',c:'with open("data.txt", "r") as f:\n    content = f.read()\n    print(content)'},
{l:'Append to file',c:'with open("data.txt", "a") as f:\n    f.write("Another line\\n")'},
]},{cat:"Other",items:[
{l:'import random',c:'import random\nnumber = random.randint(1, 100)\nprint(number)'},
{l:'import math',c:'import math\nprint(math.sqrt(16))\nprint(math.pi)'},
{l:'try / except',c:'try:\n    number = int(input("Number: "))\nexcept ValueError:\n    print("Not a number!")'},
{l:'list comprehension',c:'squares = [x**2 for x in range(10)]'},
]}];

// Build snippets panel — just the command label, clean and simple
(function(){
  var body=document.getElementById('snBody');
  SNIPPETS.forEach(function(cat){
    var h=document.createElement('div');h.className='sn-cat';h.textContent=cat.cat;body.appendChild(h);
    cat.items.forEach(function(s){
      var d=document.createElement('div');d.className='sn-item';d.textContent=s.l;
      d.addEventListener('click',function(){editor.session.insert(editor.getCursorPosition(),s.c+'\n');editor.focus();closeSn();});
      body.appendChild(d);
    });
  });
})();

function openSn(){document.getElementById('snPanel').classList.add('open');document.getElementById('snOverlay').classList.add('open');}
function closeSn(){document.getElementById('snPanel').classList.remove('open');document.getElementById('snOverlay').classList.remove('open');}
document.getElementById('hamburgerBtn').addEventListener('click',function(e){e.stopPropagation();openSn();});
document.getElementById('snClose').addEventListener('click',closeSn);
document.getElementById('snOverlay').addEventListener('click',closeSn);

// ── MINIMIZE / EXPAND (saves & restores widths properly) ──
function minimizeConsole(){
  var op=document.getElementById('outputPane'),ep=document.getElementById('editorPane');
  // Save current widths before minimizing
  savedOpWidth=op.style.width||null;
  savedEpWidth=ep.style.width||null;
  // Clear inline widths so the CSS class controls sizing
  op.style.width='';op.style.flex='';op.style.minWidth='';
  ep.style.width='';ep.style.flex='';
  op.classList.add('minimized');
  editor.resize();
}
function expandConsole(){
  var op=document.getElementById('outputPane'),ep=document.getElementById('editorPane');
  op.classList.remove('minimized');
  // Restore saved widths if any
  if(savedOpWidth){op.style.flex='none';op.style.width=savedOpWidth;ep.style.flex='none';ep.style.width=savedEpWidth;}
  editor.resize();
}

// ── DROPDOWN ──
var openDD=null;
function closeDD(){document.querySelectorAll('.dd').forEach(function(d){d.classList.remove('open')});openDD=null;}
function toggleDD(id){if(openDD===id)closeDD();else{closeDD();document.getElementById(id).classList.add('open');openDD=id;}}
document.addEventListener('mousedown',function(e){if(openDD&&!e.target.closest('.dw'))closeDD();});
document.addEventListener('DOMContentLoaded',function(){
  document.getElementById('settingsBtn').addEventListener('click',function(e){e.stopPropagation();toggleDD('settingsDD');});
  document.querySelectorAll('.dd').forEach(function(d){d.addEventListener('mousedown',function(e){e.stopPropagation()});});
  document.getElementById('togLn').addEventListener('click',function(){editor.setOption('showGutter',this.classList.toggle('active'));});
  document.getElementById('togWr').addEventListener('click',function(){editor.setOption('wrap',this.classList.toggle('active'));});
  document.getElementById('togAc').addEventListener('click',function(){var on=this.classList.toggle('active');editor.setOption('enableLiveAutocompletion',on);editor.setOption('enableBasicAutocompletion',on);});
});

// ── EDITOR ──
editor=ace.edit("editor");editor.setTheme("ace/theme/one_dark");editor.session.setMode("ace/mode/python");
editor.setOptions({fontFamily:"'Consolas',monospace",fontSize:fontSize+"px",showPrintMargin:false,tabSize:4,useSoftTabs:true,enableBasicAutocompletion:false,enableLiveAutocompletion:false,enableSnippets:false,scrollPastEnd:.5,wrap:false});
editor.selection.on('changeCursor',function(){var p=editor.getCursorPosition();document.getElementById('curPos').textContent='Ln '+(p.row+1)+', Col '+(p.column+1);});
editor.commands.addCommand({name:'runCode',bindKey:{win:'Ctrl-Enter',mac:'Cmd-Enter'},exec:function(){runCode();}});

// ── PYODIDE ──
async function initPyodide(){
  setStatus('loading','Loading Python\u2026');
  try{
    var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/pyodide/v0.27.4/full/pyodide.js';document.head.appendChild(s);
    await new Promise(function(ok,fail){s.onload=ok;s.onerror=fail;});
    pyodide=await loadPyodide({stdout:function(t){appendConsole(t)},stderr:function(t){appendConsole(t,'error')}});
    setStatus('ready','Ready');document.getElementById('loadingOverlay').classList.add('hidden');
  }catch(e){
    setStatus('error','Failed');console.error(e);
    document.getElementById('loadingOverlay').innerHTML='<div style="text-align:center;padding:40px;color:var(--t2)"><div style="font-size:40px;margin-bottom:16px">\u26A0\uFE0F</div><div style="font-size:16px">Failed to load Python</div><div style="font-size:13px;color:var(--t3);margin-top:8px">Check connection and refresh.</div></div>';
  }
}

// ── INPUT ──
function requestInput(prompt){
  return new Promise(function(resolve){
    if(prompt)appendConsole(prompt,'');
    var bar=document.getElementById('inputBar'),field=document.getElementById('inputField');
    bar.classList.add('visible');field.value='';field.focus();inputResolve=resolve;
    function onKey(e){if(e.key==='Enter'){var v=field.value;appendConsole(v,'input-echo');bar.classList.remove('visible');field.removeEventListener('keydown',onKey);inputResolve=null;resolve(v);}}
    field.addEventListener('keydown',onKey);
  });
}
window._requestInput=requestInput;

// ── RUN / STOP ──
async function runCode(){
  if(!pyodide||isRunning)return;isRunning=true;expandConsole();
  document.getElementById('runBtn').style.display='none';document.getElementById('stopBtn').style.display='';
  clearConsole();setStatus('running','Running\u2026');
  try{
    await pyodide.runPythonAsync("import sys,ast,pyodide\nasync def _web_input(prompt=''):\n result=await pyodide.code.run_js('window._requestInput('+repr(str(prompt))+')')\n return str(result)\n__builtins__.input=lambda prompt='':_web_input(prompt)\nclass _IA(ast.NodeTransformer):\n def visit_Call(self,n):\n  self.generic_visit(n)\n  if isinstance(n.func,ast.Name) and n.func.id=='input':return ast.Await(value=n)\n  return n\ndef _tfa(src):\n try:tree=ast.parse(src)\n except SyntaxError:return src\n tree=_IA().visit(tree);ast.fix_missing_locations(tree);return ast.unparse(tree)");
    var code=editor.getValue();pyodide.globals.set('_us',code);
    var tf=pyodide.runPython('_tfa(_us)');await pyodide.runPythonAsync(tf);
    setStatus('ready','Finished \u2713');
  }catch(e){
    var msg=e.message||String(e),lines=msg.split('\n'),clean=[],cap=false;
    for(var i=0;i<lines.length;i++){var l=lines[i];if(l.indexOf('File "<exec>"')!==-1||l.indexOf('File "<string>"')!==-1)cap=true;if(cap||/^\w+Error/.test(l)||/^\w+Warning/.test(l)||l.indexOf('Traceback')===0)clean.push(l);}
    if(!clean.length)clean.push(msg);appendConsole(clean.join('\n'),'error');setStatus('error','Error');
  }
  isRunning=false;document.getElementById('runBtn').style.display='';document.getElementById('stopBtn').style.display='none';
  document.getElementById('inputBar').classList.remove('visible');inputResolve=null;refreshFiles();
}
function stopCode(){
  if(inputResolve){inputResolve('');inputResolve=null;}
  document.getElementById('inputBar').classList.remove('visible');isRunning=false;
  document.getElementById('runBtn').style.display='';document.getElementById('stopBtn').style.display='none';setStatus('ready','Stopped');
}

// ── CONSOLE ──
function appendConsole(text,cls){var c=document.getElementById('console'),d=document.createElement('div');d.className='cl'+(cls?' '+cls:'');d.textContent=text;c.appendChild(d);c.scrollTop=c.scrollHeight;}
function clearConsole(){document.getElementById('console').innerHTML='';}

// ── FILES ──
async function refreshFiles(){
  if(!pyodide)return;var w=document.getElementById('fc');
  try{var f=pyodide.runPython("import os\n[f for f in sorted(os.listdir('.')) if os.path.isfile(f) and not f.startswith('.')]"),fl=f.toJs();
  if(!fl.length){w.innerHTML='<div class="fe">No files yet. Use <code>open("file.txt","w")</code> to create files.</div>';return;}
  w.innerHTML='';fl.forEach(function(fn){var d=document.createElement('div');d.className='fi';d.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>'+fn+'</span>';d.addEventListener('click',function(){viewFile(fn);});w.appendChild(d);});}catch(e){}
}
async function viewFile(fn){
  try{var content=pyodide.runPython("open("+JSON.stringify(fn)+",'r').read()"),w=document.getElementById('fc');w.innerHTML='';
  var bk=document.createElement('div');bk.className='fi';bk.style.color='var(--ac)';bk.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg><span>Back to file list</span>';bk.addEventListener('click',function(){refreshFiles();});w.appendChild(bk);
  var p=document.createElement('pre');p.style.cssText='padding:8px 12px;white-space:pre-wrap;word-break:break-all;color:var(--t1);font-size:inherit;line-height:1.7;margin:0';p.textContent=content;w.appendChild(p);}catch(e){appendConsole('Cannot read '+fn+': '+e.message,'error');}
}

// ── SAVE / OPEN ──
function saveToFile(){var c=editor.getValue(),b=new Blob([c],{type:'text/x-python'}),a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='program.py';a.click();URL.revokeObjectURL(a.href);}
function openFile(ev){var f=ev.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(e){editor.setValue(e.target.result,-1);editor.clearSelection();};r.readAsText(f);ev.target.value='';}

// ── THEME & FONT SIZE (affects editor + console + files) ──
function toggleTheme(){var h=document.documentElement,d=h.getAttribute('data-theme')==='dark';h.setAttribute('data-theme',d?'light':'dark');editor.setTheme(d?'ace/theme/chrome':'ace/theme/one_dark');}
function changeFontSize(delta){
  fontSize=Math.max(10,Math.min(28,fontSize+delta));
  editor.setFontSize(fontSize+'px');
  document.getElementById('console').style.fontSize=fontSize+'px';
  document.getElementById('fc').style.fontSize=fontSize+'px';
}
function setStatus(s,t){document.getElementById('stDot').className='st-dot '+s;document.getElementById('stTxt').textContent=t;}

// ── VERTICAL RESIZE (editor / output pane) ──
var rh=document.getElementById('resizeH'),ep=document.getElementById('editorPane'),op=document.getElementById('outputPane'),isR=false;
rh.addEventListener('mousedown',function(e){isR=true;rh.classList.add('dragging');document.body.style.cursor='col-resize';document.body.style.userSelect='none';e.preventDefault();});
document.addEventListener('mousemove',function(e){if(!isR)return;var c=document.querySelector('.main'),r=c.getBoundingClientRect(),p=Math.max(25,Math.min(75,((e.clientX-r.left)/r.width)*100));ep.style.flex='none';ep.style.width=p+'%';op.style.flex='none';op.style.width=(100-p)+'%';editor.resize();});
document.addEventListener('mouseup',function(){if(isR){isR=false;rh.classList.remove('dragging');document.body.style.cursor='';document.body.style.userSelect='';}});

// ── HORIZONTAL RESIZE (console / files split) ──
var hs=document.getElementById('hsplit'),fa=document.getElementById('filesArea'),isH=false;
hs.addEventListener('mousedown',function(e){isH=true;hs.classList.add('dragging');document.body.style.cursor='row-resize';document.body.style.userSelect='none';e.preventDefault();});
document.addEventListener('mousemove',function(e){if(!isH)return;var oc=document.querySelector('.out-content'),r=oc.getBoundingClientRect();fa.style.height=Math.max(60,Math.min(r.height-100,r.bottom-e.clientY))+'px';});
document.addEventListener('mouseup',function(){if(isH){isH=false;hs.classList.remove('dragging');document.body.style.cursor='';document.body.style.userSelect='';}});

initPyodide();
</script>
</body>
</html>
